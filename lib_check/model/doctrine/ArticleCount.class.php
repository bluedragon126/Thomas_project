<?php

/**
 * ArticleCount
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    sisterbt
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class ArticleCount extends BaseArticleCount
{
   /*
	*
	* This function checks the click count and if record is not present then it will add it.
	*
	*/
	
	public function checkClickCnt($article_id) 
	{ 
		$query = Doctrine_Query::create()->from('ArticleCount ac')->where('ac.art_id = ?', $article_id);
		$data = $query->fetchOne();
		$cnt = 0;
		if($data)
		{
			$cnt = $data->click_cnt;
			$cnt = $cnt + 1;
			$data->click_cnt = $cnt;
			$data->save();
		}
		else
		{
			$article_cnt = new ArticleCount();
			$article_cnt->art_id = $article_id;
			$article_cnt->click_cnt = 1;
			$article_cnt->save();
		}

	}
	
   /*
	*
	* This function return top most viewed bt articles with count.
	*
	*/
	public function getTopViewedArticleWithCnt($limit) 
	{ 
		$query = Doctrine_Query::create()->select('ac.art_id,ac.click_cnt')->from('ArticleCount ac');
		$query = $query->orderBy('ac.click_cnt DESC');
		$query = $query->offset(0);
		$query = $query->limit($limit);	
		$data = $query->fetchArray();
		
		$arr = array();
		for($i=0;$i<count($data);$i++)
		{
			$arr[$data[$i]['art_id']] = $data[$i]['click_cnt'];
		}
		return $arr;
	} 
	
   /*
	*
	* This function return top most bt articles.
	*
	*/
	public function getTopViewedArticle($limit) 
	{ 
		$query = Doctrine_Query::create()->select('ac.art_id,ac.click_cnt')->from('ArticleCount ac');
		$query = $query->orderBy('ac.click_cnt DESC');
		$query = $query->offset(0);
		$query = $query->limit($limit);	
		$data = $query->fetchArray();
		
		$arr = array();
		for($i=0;$i<count($data);$i++)
		{
			$arr[$i] = $data[$i]['art_id'];
		}
		return $arr;
	}  
	
	/*
	*
	* To delete article view count.
	*
	*/
	public function deleteBtViewCnt($article_id)
	{
		$query = Doctrine_Query::create()->from('ArticleCount ac')->where('ac.art_id = ?', $article_id);
		$data = $query->fetchOne();
		
		if($data) $data->delete();
	}     
}